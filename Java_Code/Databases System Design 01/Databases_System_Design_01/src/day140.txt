1ï¸âƒ£ What is a Subquery?

A subquery is a query inside another query.

Think of it like this:

â€œFirst, get this resultâ€¦ then use it to answer the main question.â€

ðŸ“Œ Key Rule (you already nailed it):
âž¡ï¸ Subquery runs first

2ï¸âƒ£ Basic Structure
SELECT column
FROM table
WHERE column OPERATOR (SELECT column FROM table);


The inner SELECT finishes first, then the outer query uses its result.

3ï¸âƒ£ Subquery in WHERE
Example: Salary higher than average
SELECT name
FROM employees
WHERE salary > (
    SELECT AVG(salary)
    FROM employees
);

How to think:

Inner query:

SELECT AVG(salary) FROM employees;


â†’ returns one number (e.g. 55000)

Outer query:

salary > 55000


â†’ finds employees earning more than average

ðŸ§  Logic:
â€œShow me employees whose salary is greater than the company average.â€

4ï¸âƒ£ Subquery with IN

Use IN when the subquery returns multiple values.

Example: Employees in NY departments
SELECT name
FROM employees
WHERE dept_id IN (
    SELECT id
    FROM departments
    WHERE location = 'NY'
);

How to think:

Inner query:

SELECT id FROM departments WHERE location = 'NY';


â†’ returns a list (e.g. 1, 3, 5)

Outer query:

dept_id IN (1, 3, 5)


ðŸ§  Logic:
â€œGive me employees whose department is located in NY.â€

5ï¸âƒ£ Subquery with EXISTS

EXISTS checks whether rows exist, not the actual values.

Example:
SELECT name
FROM employees e
WHERE EXISTS (
    SELECT 1
    FROM departments d
    WHERE d.id = e.dept_id
    AND d.location = 'NY'
);

How to think:

If the subquery returns at least one row, EXISTS = TRUE

Database stops searching once it finds a match (fast ðŸ’¨)

ðŸ§  Logic:
â€œShow me employees for whom a NY department exists.â€

6ï¸âƒ£ WHERE vs SELECT Subqueries
Subquery in SELECT (less common)
SELECT name,
       (SELECT AVG(salary) FROM employees) AS avg_salary
FROM employees;


âš ï¸ Runs once per row (can be slow)

7ï¸âƒ£ JOIN vs Subquery (Very Important ðŸ’¡)
Use Subquery when:

âœ… You need a single value (AVG, MAX, MIN)
âœ… Logic reads like a question
âœ… Filtering data

Use JOIN when:

âœ… You need columns from multiple tables
âœ… Performance matters
âœ… Large datasets

Same example using JOIN:
SELECT e.name
FROM employees e
JOIN departments d ON e.dept_id = d.id
WHERE d.location = 'NY';


ðŸ‘‰ JOIN = faster & cleaner in most real projects

8ï¸âƒ£ Mental Model (Remember This ðŸ§ )

Ask yourself:

â€œWhat do I need to know first?â€

That answer = subquery


--------------------------------Practice Basic Level Queries---------------------------------------

SELECT customerNumber FROM payments
WHERE amount > (SELECT AVG(amount) FROM payments);

SELECT customerName
FROM customers
WHERE customerNumber IN (SELECT customerNumber FROM orders WHERE status = 'Cancelled');

SELECT customerName
FROM customers e
WHERE EXISTS (SELECT 1 FROM payments d WHERE d.customerNumber = e.customerNumber AND d.amount > 1000 );

